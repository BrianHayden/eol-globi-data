-- open existing neo4j graph
g = new Neo4jGraph('/Users/jorrit/dev/trophic/trophic-graph/data/graph.db/')
g = new Neo4jGraph('/Users/jorrit/dev/trophic/trophic-graph/data/graph.db/')


-- get vertex iterator by species name:
g.idx("taxons").get('name', 'Ampelisca agassizi')

-- get first node of iterator
first = g.idx("taxons").get('name', 'Ampelisca agassizi').iterator().next()

-- get studies associated with all predators eating 'Ampelisca agassizi'
first.inE.outV.inE.outV.inE.outV.title

-- number of specimen that ate 'Ampelisca agassizi'
first.inE.outV.inE.count()

-- number of nodes in graph
g.vertices.count()
-- or 
g.V.count()

-- get me the all species is contained in at least two studies (not quite sure about this)
study1_species = []
shared_species = []

studies[0].outE('COLLECTED').inV.outE('CLASSIFIED_AS').inV.uniqueObject.aggregate(study1_species)
studies[0].outE('COLLECTED').inV.outE('ATE').inV.outE('CLASSIFIED_AS').inV.uniqueObject.aggregate(study1_species)

studies[1].outE('COLLECTED').inV.outE('CLASSIFIED_AS').inV.uniqueObject.retain(study1_species).aggregate(shared_species)
studies[1].outE('COLLECTED').inV.outE('ATE').inV.outE('CLASSIFIED_AS').inV.uniqueObject.retain(study1_species).aggregate(shared_species)

-- result -- 
gremlin> shared_species.scientificName
==>Squilla empusa
==>Cynoscion arenarius
==>Polydactylus octonemus
==>Leiostomus xanthurus
==>Micropogonias undulatus
gremlin> 





g.V.inE("CLASSIFIED_AS").outV.as('x').inE("COLLECTED").outV.uniqueObject.back('x').outE("CLASSIFIED_AS").inV.scientificName
==>Rhynchoconger flavus
==>Squilla empusa



-- give me all unique vertices that have outgoing "COLLECTED" edges
g.V.inE("COLLECTED").outV.uniqueObject

-- number of outgoing "COLLECTED" edges for the second study 
g.V.inE("COLLECTED").outV.uniqueObject.getAt(1).outE("COLLECTED").count()

-- increment a variable i whenever a outgoing edge "COLLECTED" is encoutered for the second study
-- note that the result is same as the count() method.
i=0
g.V.inE("COLLECTED").outV.uniqueObject.getAt(1).outE("COLLECTED").sideEffect{i++}

-- get all unique studies that classified species in the graph
g.V.inE("CLASSIFIED_AS").outV.inE("COLLECTED").outV.uniqueObject

--- using JUNG to calculate pageRank of nodes in the graph, see https://github.com/tinkerpop/gremlin/wiki/Using-JUNG  ---
gJung = new GraphJung(g)
pr = new PageRank<Vertex,Edge>(gJung, 0.15d) 
pr.evaluate()


--- resolving species with semantic web technology abd ---
from https://github.com/tinkerpop/gremlin/wiki/LinkedData-Sail
g = new LinkedDataSailGraph(new MemoryStoreSailGraph()) 
v = g.v('http://dbpedia.org/resource/Micropogonias_undulatus')
g.addNamespace('dbpedia','http://dbpedia.org/resource/')

